"use strict";(self.webpackChunkbeancount_web=self.webpackChunkbeancount_web||[]).push([[376],{1842:function(e,t,n){var a=n(870);t.Z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";t=Number(t).toFixed(2);var r=(0,a.jo)(e);return"Income"===r?t>0?"-".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"+".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"Assets"===r?t>0?"+".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"-".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"Expenses"===r?t>0?"-".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"+".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"Liabilities"===r?t>0?"+".concat(n).concat(Math.abs(t)," ").concat(n?"":i):"-".concat(n).concat(Math.abs(t)," ").concat(n?"":i):String(t)}},3744:function(e,t,n){var a=n(1413),i=n(5987),r=(n(7313),n(6417)),s=["iconType"];t.Z=function(e){var t=e.iconType,n=(0,i.Z)(e,s);return(0,r.jsx)("img",(0,a.Z)((0,a.Z)({},n),{},{src:"../../web/icons/".concat(t,".png"),alt:"",width:32,height:32}))}},991:function(e,t,n){var a=n(1413),i=n(5671),r=n(3144),s=n(136),o=n(8557),c=n(7164),l=n(7552),u=n(7258),d=n(2346),h=n(6204),m=n(2061),p=n(7313),f=n(870),y=n(1842),x=n(3744),g=n(2830),Z=n(6417),v=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={transactions:[],selectedMonth:"",loading:!1},e.handleQueryAccountTransaction=function(t){if(t){var n,a;if(e.setState({loading:!0}),e.state.selectedMonth){var i=e.state.selectedMonth.split("-").filter((function(e){return e}));1===i.length?n=i[0]:2===i.length&&(n=i[0],a=i[1])}(0,f.he)("/api/auth/transaction?account=".concat(t,"&year=").concat(n,"&month=").concat(a)).then((function(t){e.setState({transactions:t})})).catch(console.error).finally((function(){e.setState({loading:!1})}))}},e.handleChangeMonth=function(t){e.setState({selectedMonth:t},(function(){e.handleQueryAccountTransaction(e.props.account)}))},e}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.props.account&&this.handleQueryAccountTransaction(this.props.account)}},{key:"componentWillReceiveProps",value:function(e){e.visible&&this.handleQueryAccountTransaction(e.account)}},{key:"render",value:function(){var e=this.props.account,t=this.state,n=t.transactions,i=t.loading;return(0,Z.jsx)(u.Z,(0,a.Z)((0,a.Z)({title:(0,Z.jsxs)("div",{style:{fontSize:14},children:[(0,Z.jsx)("div",{children:e}),(0,Z.jsxs)("div",{children:["\u6700\u8fd1",n.length,"\u6761\u4ea4\u6613\u8bb0\u5f55"]})]}),placement:"bottom",closable:!0,className:"page-drawer",height:"90vh",bodyStyle:{display:"flex",justifyContent:"center"}},this.props),{},{children:(0,Z.jsxs)("div",{className:"page-form",children:[(0,Z.jsx)(g.Z,{size:"middle",value:this.state.selectedMonth,onChange:this.handleChangeMonth}),(0,Z.jsx)(d.ZP,{itemLayout:"horizontal",loading:i,dataSource:n,renderItem:function(t){var n,a,i=t.costCurrency&&t.currency!==t.costCurrency,r=Boolean(t.price);return i&&(n=(0,m.Z)(t.costPrice).mul((0,m.Z)(t.number).abs()),r&&(a=(0,m.Z)(t.price).sub((0,m.Z)(t.costPrice)).mul((0,m.Z)(t.number).abs()))),(0,Z.jsx)(d.ZP.Item,{actions:[(0,Z.jsxs)("div",{style:{textAlign:"right"},children:[(0,Z.jsx)("div",{children:t.number?(0,y.Z)(e,t.number,t.currencySymbol,t.currency):""}),(0,Z.jsx)("div",{style:{fontSize:"12px"},children:t.balance})]})],children:(0,Z.jsx)(d.ZP.Item.Meta,{avatar:(0,Z.jsx)(x.Z,{iconType:(0,f.h$)(e)}),title:t.desc,description:(0,Z.jsxs)("div",{children:[t.tags&&(0,Z.jsx)("div",{children:t.tags.map((function(e){return(0,Z.jsxs)("a",{style:{marginRight:"4px"},children:["#",e]})}))}),(0,Z.jsxs)("span",{children:[t.date,"\xa0",t.payee,"\xa0",t.commodity]}),i&&(0,Z.jsx)("div",{style:{marginTop:"13px"},children:r?(0,Z.jsxs)(p.Fragment,{children:[(0,Z.jsxs)(h.Z,{children:["\u6210\u672c: ",t.costPrice," (",t.costDate,")"]}),(0,Z.jsxs)(h.Z,{children:["\u786e\u8ba4\u51c0\u503c: ",t.price]}),a>=0?(0,Z.jsxs)(p.Fragment,{children:[(0,Z.jsxs)(h.Z,{icon:(0,Z.jsx)(c.Z,{}),color:"#f50",children:[(100*Number(a)/Number(n)).toFixed(2),"%"]}),(0,Z.jsxs)(h.Z,{color:"#f50",children:["+",Math.abs(a).toFixed(2)]})]}):(0,Z.jsxs)(p.Fragment,{children:[(0,Z.jsxs)(h.Z,{icon:(0,Z.jsx)(l.Z,{}),color:"#1DA57A",children:[(100*Number(a)/Number(n)).toFixed(2),"%"]}),(0,Z.jsxs)(h.Z,{color:"#1DA57A",children:["-",Math.abs(a).toFixed(2)]})]})]}):(0,Z.jsx)(p.Fragment,{children:(0,Z.jsxs)(h.Z,{children:["\u51c0\u503c: ",t.costPrice]})})})]})})})}})]})}))}}]),n}(p.Component);t.Z=v},1382:function(e,t,n){var a=n(7762),i=n(3433),r=n(5671),s=n(3144),o=n(136),c=n(8557),l=n(1413),u=n(5987),d=n(3128),h=n(8661),m=n(5049),p=n(2138),f=n(2092),y=n(2008),x=n(5291),g=n(7258),Z=n(6204),v=n(3655),j=n(1279),b=n(6155),S=n(9491),C=n(658),A=n.n(C),T=n(2061),M=n(7313),w=n(870),Y=n(3744),D=n(6417),P=["form","initialValue"],k=f.Z.Option,F={required:"${label} \u4e0d\u80fd\u4e3a\u7a7a\uff01"},I=function(e){var t=e.form,n=e.initialValue,a=(0,u.Z)(e,P);return M.useEffect((function(){t.current.setFields([{name:a.name,value:n}])}),[]),(0,D.jsx)(y.Z.List,(0,l.Z)({},a))},q=function(e){(0,o.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).formRef=M.createRef(),e.state={loading:!1,drawerVisible:!1,templateLoading:!1,accounts:[],payees:[],autoCompletePayees:[],templates:e.props.defaultAccounts?[{entries:(0,i.Z)(e.props.defaultAccounts)}]:[],showTag:!1,tags:[],isDivide:!1},e.queryAllValidAccounts=function(){(0,w.he)("/api/auth/account/valid").then((function(t){e.setState({accounts:t})})).catch(console.error)},e.queryLatest100Payees=function(){(0,w.he)("/api/auth/transaction/payee").then((function(t){e.setState({payees:t,autoCompletePayees:t.slice(0,Math.max(t.length,10))})})).catch(console.error)},e.queryTransactionTemplates=function(){(0,w.he)("/api/auth/transaction/template").then((function(t){e.setState({templates:t})})).catch(console.error)},e.queryAllTags=function(){(0,w.he)("/api/auth/tags").then((function(t){e.setState({tags:t})})).catch(console.error)},e.handleSearchPayee=function(t){var n=e.state.payees.filter((function(e){return e.indexOf(t)>=0}));e.setState({autoCompletePayees:n})},e.handleSaveTransactionTemplate=function(){var t=e.formRef.current.getFieldsValue(),n=t.payee,a=t.desc;t.templateName="".concat(n||"","-").concat(a||""),e.setState({templateLoading:!0}),(0,w.he)("/api/auth/transaction/template",{method:"POST",body:t}).then((function(t){x.ZP.success("\u4fdd\u5b58\u6a21\u7248\u6210\u529f"),e.queryTransactionTemplates()})).finally((function(){e.setState({templateLoading:!1,drawerVisible:!1})}))},e.handleChangeAmount=function(t){e.setState({balanceAmount:t})},e.handleChangeAccount=function(t,n){var a=e.formRef.current.getFieldsValue().entries,i=e.getAccountCommodity(t);a[n].commodity=i,i!==e.props.commodity.currency&&(a[n].priceCommodity=e.props.commodity.currency),e.formRef.current.setFieldsValue({entries:a})},e.getAccountCommodity=function(t){var n=e.state.accounts.filter((function(e){return e.account===t}))[0];return n?n.currency:""},e.handleSubmit=function(t){var n=t.divideCount,r=t.divideCycle;if(n&&n>0){var s=A()(t.date);t.divideDateList=[];for(var o=0;o<n;o++)"day"===r?t.divideDateList.push(s.add(o,"days").format("YYYY-MM-DD")):"week"===r?t.divideDateList.push(s.add(o,"weeks").format("YYYY-MM-DD")):"month"===r&&t.divideDateList.push(s.add(o,"months").format("YYYY-MM-DD"));delete t.divideCount,delete t.divideCycle}if(t.entries&&t.entries.length){var c,l,u=0,d=(0,a.Z)(t.entries);try{for(d.s();!(l=d.n()).done;){var h=l.value;h&&h.number||(c=h,u++)}}catch(m){d.e(m)}finally{d.f()}if(1==u)c.number=String(e.computeBalanceAmount(t));else if(u>1)return void x.ZP.error("\u8d26\u76ee\u91d1\u989d\u9879\u4e0d\u80fd\u4e3a\u7a7a");e.setState({loading:!0}),(0,w.he)("/api/auth/transaction",{method:"POST",body:t}).then((function(n){x.ZP.success("\u6dfb\u52a0\u6210\u529f"),e.formRef.current.resetFields(),e.formRef.current.setFieldsValue({date:A()().format("YYYY-MM-DD")});var a=e.state.payees;if(t.payee){var r=Array.from(new Set([].concat((0,i.Z)(a),[t.payee]))),s=r.slice(0,Math.max(r.length,10));e.setState({autoCompletePayees:s})}else e.setState({autoCompletePayees:a.slice(0,Math.max(a.length,10))});e.props.onSubmit&&e.props.onSubmit(t)})).finally((function(){e.setState({loading:!1})}))}else x.ZP.error("\u8d26\u76ee\u4e0d\u80fd\u4e3a\u7a7a")},e.handleDeleteTransactionTemplate=function(t,n){t.preventDefault(),(0,w.he)("/api/auth/transaction/template?id=".concat(n),{method:"DELETE"}).then((function(t){e.setState({templates:e.state.templates.filter((function(e){return e.id!==n}))})}))},e.handleSetTemplate=function(t){delete t.date,t.entries.forEach((function(e){return e.amount=Number(e.amount)})),e.formRef.current.setFieldsValue(t)},e.handleToggleShowTagInput=function(){e.setState({showTag:!e.state.showTag})},e.handleToggleShowDivideInput=function(){e.setState({isDivide:!e.state.isDivide})},e}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.visible&&setTimeout((function(){e.queryAllValidAccounts(),e.queryLatest100Payees(),e.queryTransactionTemplates(),e.queryAllTags()}),1e3)}},{key:"componentWillReceiveProps",value:function(e){e.visible&&!this.loaded&&(this.queryAllValidAccounts(),this.queryLatest100Payees(),this.queryTransactionTemplates(),this.queryAllTags(),this.loaded=!0),this.formRef.current&&e.defaultAccounts&&e.defaultAccounts.length>0&&(!this.props.defaultAccounts||e.defaultAccounts[0].account!==this.props.defaultAccounts[0].account)&&this.formRef.current.setFieldsValue({entries:(0,i.Z)(e.defaultAccounts)})}},{key:"computeBalanceAmount",value:function(e){var t=(0,T.Z)(0);return e.entries.filter((function(e){return e&&e.number})).forEach((function(e){var n=e.number,a=e.commodity,i=e.price,r=e.priceCommodity;r&&r!==a&&n&&i?t=(t||(0,T.Z)(0)).sub((0,T.Z)(n).mul((0,T.Z)(i))):n&&(t=(t||(0,T.Z)(0)).sub((0,T.Z)(n)))})),t.toNumber()}},{key:"render",value:function(){var e=this;return(0,D.jsx)(g.Z,(0,l.Z)((0,l.Z)({title:"\u8bb0\u8d26",placement:"bottom",closable:!0,height:"90vh",className:"page-drawer",bodyStyle:{display:"flex",justifyContent:"center"},forceRender:!0},this.props),{},{children:(0,D.jsxs)(y.Z,{className:"page-form",size:"large",ref:this.formRef,onFinish:this.handleSubmit,validateMessages:F,children:[(0,D.jsx)("div",{style:{marginBottom:"1rem"},children:this.state.templates.map((function(t){return(0,D.jsx)("a",{onClick:function(){e.handleSetTemplate(t)},children:(0,D.jsx)(Z.Z,{size:"middle",color:"#1DA57A",closable:!0,onClose:function(n){e.handleDeleteTransactionTemplate(n,t.id)},children:t.templateName||t.payee||t.id})},t.id)}))}),(0,D.jsx)(y.Z.Item,{name:"date",initialValue:A()().format("YYYY-MM-DD"),rules:[{required:!0}],children:(0,D.jsx)(v.Z,{type:"date",placeholder:"\u4ea4\u6613\u65f6\u95f4"})}),(0,D.jsx)(y.Z.Item,{name:"payee",children:(0,D.jsx)(j.Z,{onSearch:this.handleSearchPayee,placeholder:"\u6536\u6b3e\u4eba/\u5546\u6237/\u6536\u5165\u6765\u6e90\u6e20\u9053",children:this.state.autoCompletePayees.map((function(e){return(0,D.jsx)(j.Z.Option,{value:e,children:e},e)}))})}),(0,D.jsx)(y.Z.Item,{name:"desc",rules:[{required:!0,message:"\u8be6\u7ec6\u63cf\u8ff0"}],style:{flex:1},children:(0,D.jsx)(v.Z,{placeholder:"\u8be6\u7ec6\u63cf\u8ff0\uff0c\u8bb0\u5f55\u7ec6\u8282"})}),(0,D.jsxs)("div",{style:{display:"flex"},children:[(0,D.jsx)(d.Z,{style:{color:this.state.showTag?"#1DA57A":"gray",width:"40px",lineHeight:"40px",fontSize:"20px"},onClick:this.handleToggleShowTagInput}),(0,D.jsx)(h.Z,{style:{color:this.state.isDivide?"#1DA57A":"gray",width:"40px",lineHeight:"40px",fontSize:"20px"},onClick:this.handleToggleShowDivideInput})]}),this.state.showTag&&(0,D.jsxs)(M.Fragment,{children:[(0,D.jsx)(b.Z,{plain:!0,children:"\u6807\u7b7e"}),(0,D.jsx)(y.Z.Item,{name:"tags",rules:[{required:!0}],children:(0,D.jsx)(f.Z,{mode:"tags",style:{width:"100%"},placeholder:"\u6807\u7b7e\uff08\u4e0d\u652f\u6301\u4e2d\u6587\uff09\uff0c\u65c5\u884c/\u8ba1\u5212/\u5b66\u4e60",children:this.state.tags.map((function(e){return(0,D.jsx)(f.Z.Option,{value:e,children:e},e)}))})})]}),this.state.isDivide&&(0,D.jsxs)(M.Fragment,{children:[(0,D.jsx)(b.Z,{plain:!0,children:"\u9884\u652f\u5206\u671f"}),(0,D.jsxs)("div",{style:{display:"flex"},children:[(0,D.jsx)(y.Z.Item,{name:"divideCount",rules:[{required:!0,message:"\u5206\u671f\u6570"}],style:{flex:"2",marginRight:"12px"},children:(0,D.jsx)(v.Z,{type:"number",step:"1",addonAfter:"\u671f"})}),(0,D.jsx)(y.Z.Item,{name:"divideCycle",initialValue:"month",style:{flex:"1"},children:(0,D.jsxs)(f.Z,{style:{width:"100%"},children:[(0,D.jsx)(f.Z.Option,{value:"day",children:"\u95f4\u9694\u4e00\u5929"}),(0,D.jsx)(f.Z.Option,{value:"week",children:"\u95f4\u9694\u4e00\u5468"}),(0,D.jsx)(f.Z.Option,{value:"month",children:"\u95f4\u9694\u4e00\u6708"})]})})]})]}),(0,D.jsx)(b.Z,{plain:!0,children:"\u8d26\u6237\u660e\u7ec6"}),(0,D.jsx)(y.Z.Item,{children:(0,D.jsx)(I,{form:this.formRef,name:"entries",children:function(t,n){var a=n.add,i=n.remove;return(0,D.jsxs)("div",{children:[t.map((function(t){var n=null,a=e.formRef.current.getFieldsValue().entries[t.name];a&&(n=e.getAccountCommodity(a.account));var r=e.formRef.current.getFieldsValue(["entries"]),s=e.computeBalanceAmount(r);return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginBottom:8},children:[(0,D.jsx)(y.Z.Item,{name:[t.name,"account"],fieldKey:[t.fieldKey,"account"],rules:[{required:!0,message:"\u5fc5\u8f93\u9879"}],children:(0,D.jsx)(f.Z,{showSearch:!0,placeholder:"\u9009\u62e9\u8d26\u6237",optionFilterProp:"children",onChange:function(n){e.handleChangeAccount(n,t.name)},style:{marginRight:"10px"},children:e.state.accounts.map((function(e){return(0,D.jsxs)(k,{value:e.account,children:[(0,D.jsx)(Y.Z,{style:{width:"22px",height:"22px",marginRight:"6px"},iconType:(0,w.h$)(e.account)}),e.account]})}))})}),n&&n!==e.props.commodity.currency&&(0,D.jsxs)(M.Fragment,{children:[(0,D.jsx)(y.Z.Item,{hidden:!0,name:[t.name,"priceCurrency"],fieldKey:[t.fieldKey,"priceCurrency"],children:(0,D.jsx)(v.Z,{})}),(0,D.jsx)(y.Z.Item,{name:[t.name,"price"],fieldKey:[t.fieldKey,"price"],children:(0,D.jsx)(v.Z,{type:"number",step:"0.01",addonBefore:"1 ".concat(n,"\u2248"),addonAfter:e.props.commodity.currency,placeholder:"\u6c47\u7387/\u51c0\u503c\uff08\u9009\u586b\uff09",onChange:e.handleChangeAmount})})]}),(0,D.jsx)(y.Z.Item,{hidden:!0,name:[t.name,"currency"],fieldKey:[t.fieldKey,"currency"],children:(0,D.jsx)(v.Z,{})}),(0,D.jsxs)("div",{style:{display:"flex"},children:[(0,D.jsx)(y.Z.Item,{name:[t.name,"number"],fieldKey:[t.fieldKey,"number"],style:{flex:1},children:(0,D.jsx)(v.Z,{type:"number",step:"0.01",addonBefore:n,placeholder:s||"".concat(e.state.isDivide?"\u9884\u652f\u5206\u671f\u603b":"","\u91d1\u989d"),onChange:e.handleChangeAmount,style:{flex:1}})}),(0,D.jsx)(m.Z,{style:{width:"40px",lineHeight:"40px",fontSize:"20px"},onClick:function(){i(t.name)}})]}),(0,D.jsx)(b.Z,{})]},t.name)})),(0,D.jsx)(y.Z.Item,{children:(0,D.jsxs)(S.Z,{type:"dashed",onClick:function(){a()},block:!0,children:[(0,D.jsx)(p.Z,{})," \u6dfb\u52a0\u8d26\u76ee"]})})]})}})}),(0,D.jsxs)(y.Z.Item,{children:[(0,D.jsx)(S.Z,{type:"primary",htmlType:"submit",loading:this.state.loading,className:"submit-button",children:"\u4fdd\u5b58"}),"\xa0\xa0",(0,D.jsx)(S.Z,{htmlType:"button",disabled:this.state.loading,loading:this.state.templateLoading,onClick:this.handleSaveTransactionTemplate,block:!0,children:"\u4fdd\u5b58\u4e3a\u6a21\u7248"})]}),(0,D.jsx)(y.Z.Item,{})]})}))}}]),n}(M.Component);t.Z=q},2830:function(e,t,n){var a=n(1413),i=n(5671),r=n(3144),s=n(136),o=n(8557),c=n(2092),l=n(658),u=n.n(l),d=n(7313),h=n(870),m=n(6417),p=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).currentYear=u()().format("YYYY"),e.currentMonth=u()().format("YYYY-M"),e.state={loading:!1,years:[e.currentYear],months:[e.currentMonth]},e.queryMonthList=function(){e.setState({loading:!0}),(0,h.he)("/api/auth/stats/months").then((function(t){var n=Array.from(new Set(t.map((function(e){return e.split("-")[0]}))));e.setState({months:t,years:n})})).catch(console.error).finally((function(){e.setState({loading:!1})}))},e}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.queryMonthList()}},{key:"render",value:function(){return(0,m.jsxs)(c.Z,(0,a.Z)((0,a.Z)({size:"small",showSearch:!0,placeholder:"\u9009\u62e9\u6708\u4efd",style:{width:"120px"}},this.props),{},{children:[!this.props.onlyShowMonth&&(0,m.jsx)(c.Z.Option,{value:"",children:"\u4e0d\u9650"}),!this.props.onlyShowMonth&&this.state.years.reverse().map((function(e){return(0,m.jsx)(c.Z.Option,{value:e,children:u()(e).format("YYYY\u5e74")},e)})),this.state.months.reverse().map((function(e){return(0,m.jsx)(c.Z.Option,{value:e,children:u()(e).format("YYYY\u5e74MM\u6708")},e)}))]}))}}]),n}(d.Component);t.Z=p},5789:function(e,t,n){var a=n(1413),i=n(5671),r=n(3144),s=n(136),o=n(8557),c=n(7313),l=n(6417);t.Z=function(e){return function(t){(0,s.Z)(c,t);var n=(0,o.Z)(c);function c(){var e;(0,i.Z)(this,c);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).defaultCommodity={currency:"CNY",symbol:"\uffe5"},e.currentCommodity=window.localStorage.getItem("ledgerCurrency"),e}return(0,r.Z)(c,[{key:"render",value:function(){return(0,l.jsx)(e,(0,a.Z)((0,a.Z)({},this.props),{},{commodity:this.currentCommodity?JSON.parse(this.currentCommodity):this.defaultCommodity}))}}]),c}(c.Component)}}}]);