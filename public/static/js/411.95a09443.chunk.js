"use strict";(self.webpackChunkbeancount_web=self.webpackChunkbeancount_web||[]).push([[411],{6411:function(e,t,n){n.r(t);var i=n(5671),r=n(3144),a=n(136),l=n(8557),s=n(3598),d=n(2138),c=n(8137),o=n(9720),h=n(8578),u=n(7440),g=n(4401),m=n(9491),f=n(8080),p=n(2008),x=n(3655),y=n(6345),j=n(7313),Z=n(870),C=n(9277),w=n(5789),v=n(6417),S={required:"${label} \u4e0d\u80fd\u4e3a\u7a7a\uff01"},b=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return(e=t.call.apply(t,[this].concat(a))).theme=e.context.theme,e.formRef=j.createRef(),e.state={loading:!1,expand:!1,newLedger:!1,selectedLedger:{},ledgers:[],config:{}},e.handleQueryLedgerList=function(){e.setState({loading:!0}),(0,Z.he)("/api/ledger",{method:"GET"}).then((function(t){e.setState({ledgers:t,newLedger:0==t.length})})).finally((function(){e.setState({loading:!1})}))},e.handleQueryServerConfig=function(){e.setState({loading:!0}),(0,Z.he)("/api/config",{method:"GET"}).then((function(t){t.dataPath?e.setState({config:t}):window.location.href="/web/#/init"})).finally((function(){e.setState({loading:!1})}))},e.handleCreateLedger=function(t){t.secret||!e.state.newLedger?e.handleReqCreateLedger(t):g.Z.confirm({title:"\u63d0\u9192",icon:(0,v.jsx)(s.Z,{}),content:"\u672a\u8bbe\u7f6e\u5bc6\u7801\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u5b89\u5168",okText:"\u786e\u8ba4\u4e0d\u8bbe\u7f6e\u5bc6\u7801",cancelText:"\u53d6\u6d88",onOk:function(){return e.handleReqCreateLedger(t)}})},e.handleReqCreateLedger=function(t){e.setState({loading:!0}),(0,Z.he)("/api/ledger",{method:"POST",headers:{"Content-Type":"application/json"},body:t}).then((function(t){window.localStorage.setItem("ledgerId",t.ledgerId),t.title&&window.localStorage.setItem("ledgerTitle",t.title),t.currency&&window.localStorage.setItem("ledgerCurrency",JSON.stringify({currency:t.currency,symbol:t.currencySymbol})),e.props.history.replace("/")})).finally((function(){e.setState({loading:!1})}))},e.handleSelectLedger=function(t){e.setState({selectedLedger:t})},e}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.handleQueryServerConfig(),this.handleQueryLedgerList()}},{key:"render",value:function(){var e=this;return this.context.theme!==this.theme&&(this.theme=this.context.theme),this.state.selectedLedger.mail||this.state.newLedger?(0,v.jsx)("div",{className:"ledger-page",children:(0,v.jsx)("div",{children:(0,v.jsxs)(p.Z,{name:"add-account-form",size:"middle",layout:"vertical",ref:this.formRef,onFinish:this.handleCreateLedger,validateMessages:S,loading:this.state.loading,children:[(0,v.jsx)(p.Z.Item,{name:"ledgerName",label:"\u8d26\u672c\u540d\u79f0",initialValue:this.state.selectedLedger.mail||"",rules:[{required:!0}],children:(0,v.jsx)(x.Z,{placeholder:"\u4f60\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u7684\u8d26\u672c\uff0c\u8d26\u672c\u4e4b\u95f4\u7684\u6570\u636e\u65e0\u6cd5\u4e92\u901a"})}),(0,v.jsx)(p.Z.Item,{label:"\u4fee\u6539\u6e90\u6587\u4ef6\u65f6\u662f\u5426\u5907\u4efd\u6570\u636e",name:"isBak",valuePropName:"checked",rules:[{required:!0}],initialValue:this.state.config.isBak,children:(0,v.jsx)(y.Z,{})}),(0,v.jsx)(p.Z.Item,{name:"secret",label:"\u8d26\u672c\u5bc6\u7801",children:(0,v.jsx)(x.Z,{type:"password",placeholder:"\u8d26\u672c\u5bc6\u7801"})}),!this.state.selectedLedger.mail&&(0,v.jsxs)(j.Fragment,{children:[(0,v.jsx)("div",{style:{fontSize:14,marginBottom:"2rem",textAlign:"center"},children:(0,v.jsxs)("a",{onClick:function(){e.setState({expand:!e.state.expand})},children:[this.state.expand?(0,v.jsx)(h.Z,{}):(0,v.jsx)(u.Z,{})," \u66f4\u591a\u8d26\u672c\u8bbe\u7f6e"]})}),this.state.expand&&(0,v.jsxs)(j.Fragment,{children:[(0,v.jsx)(p.Z.Item,{label:"\u8d26\u672c\u5f00\u59cb\u65e5\u671f",name:"startDate",initialValue:this.state.config.startDate,rules:[{required:!0}],children:(0,v.jsx)(x.Z,{type:"date",placeholder:"\u8d26\u672c\u5f00\u59cb\u65e5\u671f"})}),(0,v.jsx)(p.Z.Item,{label:"\u5e01\u79cd",name:"operatingCurrency",initialValue:this.state.config.operatingCurrency,rules:[{required:!0}],children:(0,v.jsx)(x.Z,{placeholder:"\u5e01\u79cd"})}),(0,v.jsx)(p.Z.Item,{label:"\u5e73\u8861\u8d26\u6237\u540d\u79f0\u8bbe\u7f6e",name:"openingBalances",initialValue:this.state.config.openingBalances,rules:[{required:!0}],children:(0,v.jsx)(x.Z,{placeholder:"\u5e73\u8861\u8d26\u6237\u540d\u79f0\u8bbe\u7f6e"})})]})]}),(0,v.jsx)(p.Z.Item,{children:(0,v.jsx)(m.Z,{type:"primary",block:!0,htmlType:"submit",children:"\u521b\u5efa/\u8fdb\u5165\u4e2a\u4eba\u8d26\u672c"})}),this.state.ledgers.length>0&&(0,v.jsx)(p.Z.Item,{children:(0,v.jsx)(m.Z,{block:!0,onClick:function(){e.setState({selectedLedger:{},newLedger:!1})},children:"\u8fd4\u56de\u8d26\u672c"})})]})})}):(0,v.jsxs)("div",{className:"ledger-page",children:[(0,v.jsx)("div",{children:(0,v.jsx)(m.Z,{block:!0,type:"dashed",icon:(0,v.jsx)(d.Z,{}),onClick:function(){e.setState({newLedger:!0})},children:"\u521b\u5efa\u65b0\u8d26\u672c"})}),this.state.ledgers.map((function(t){return(0,v.jsx)(f.Z,{style:{width:"100%",marginTop:16,cursor:"pointer"},loading:e.state.loading,children:(0,v.jsx)(f.Z.Meta,{onClick:function(){e.handleSelectLedger(t)},title:t.title,description:(0,v.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[(0,v.jsx)(c.Z,{}),"\xa0",t.mail]}),"\xa0\xa0",t.createDate&&(0,v.jsxs)("span",{children:[(0,v.jsx)(o.Z,{}),"\xa0",t.createDate]})]}),(0,v.jsx)("div",{children:(0,v.jsx)("span",{children:t.operatingCurrency})})]})})})}))]})}}]),n}(j.Component);b.contextType=C.Z,t.default=(0,w.Z)(b)},5789:function(e,t,n){var i=n(1413),r=n(5671),a=n(3144),l=n(136),s=n(8557),d=n(7313),c=n(6417);t.Z=function(e){return function(t){(0,l.Z)(d,t);var n=(0,s.Z)(d);function d(){var e;(0,r.Z)(this,d);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).defaultCommodity={currency:"CNY",symbol:"\uffe5"},e.currentCommodity=window.localStorage.getItem("ledgerCurrency"),e}return(0,a.Z)(d,[{key:"render",value:function(){return(0,c.jsx)(e,(0,i.Z)((0,i.Z)({},this.props),{},{commodity:this.currentCommodity?JSON.parse(this.currentCommodity):this.defaultCommodity}))}}]),d}(d.Component)}}}]);