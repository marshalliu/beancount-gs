"use strict";(self.webpackChunkbeancount_web=self.webpackChunkbeancount_web||[]).push([[801],{8261:function(e,t,n){var a=n(1413),s=n(3546),i=(n(7313),n(6417));t.Z=function(e){return e.hide?(0,i.jsx)(s.Z,(0,a.Z)((0,a.Z)({},e),{},{value:"***",prefix:e.hide?"":e.prefix})):(0,i.jsx)(s.Z,(0,a.Z)({},e))}},801:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var a=n(1413),s=n(5671),i=n(3144),r=n(136),c=n(8557),o=n(4874),l=n(1741),h=n(7164),d=n(7552),u=n(2716),p=n(4632),x=n(5491),g=n(4893),m=n(8276),y=n(2652),f=n(2346),j=n(6204),Z=n(9491),v=n(8197),b=n(9624),T=n(658),D=n.n(T),w=n(7313),M=n(1842),S=n(3744),C=n(991),A=n(1382),I=n(7258),L=n(6778),O=n(870),k=n(2830),E=n(6417),P=function(e){(0,r.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,s.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).cache={},e.state={calendarData:[],loading:!1,selectedMonth:e.props.month},e.getCurrentMonth=function(){return e.state.selectedMonth?D()(e.state.selectedMonth):D()()},e.queryTransactionList=function(t,n){Object.keys(e.cache).includes("".concat(t,"-").concat(n))?e.setState({calendarData:e.cache["".concat(t,"-").concat(n)]}):(e.setState({loading:!0}),(0,O.he)("/api/auth/stats/month/calendar?year=".concat(t,"&month=").concat(n)).then((function(a){e.cache["".concat(t,"-").concat(n)]=a,e.setState({calendarData:a})})).catch(console.error).finally((function(){e.setState({loading:!1})})))},e.handleChangeMonth=function(t){e.setState({selectedMonth:t.format("yyyy-M")},(function(){e.queryTransactionList(t.year(),t.month()+1)}))},e.getListData=function(t){return e.state.calendarData.filter((function(e){var n=D()(e.date);return n.year()===t.year()&&n.month()+1===t.month()+1&&n.date()===t.date()}))},e.dateCellRender=function(t){var n=e.getCurrentMonth();if(n.year()!==t.year()||n.month()!==t.month())return(0,E.jsx)("div",{onClick:function(e){e.stopPropagation()},style:{height:"100px",cursor:"default"}});var a=e.getListData(t);return(0,E.jsxs)("div",{className:"date-cell",children:[(0,E.jsx)("div",{className:"date",children:t.date()}),a.map((function(e,t){return(0,E.jsxs)("div",{children:["Expenses"===e.account&&(0,E.jsx)("span",{className:"expenses",children:(0,M.Z)(e.account,e.amount)}),"Income"===e.account&&(0,E.jsx)("span",{className:"income",children:(0,M.Z)(e.account,e.amount)})]},t)}))]})},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.getCurrentMonth();this.queryTransactionList(e.year(),e.month()+1)}},{key:"render",value:function(){var e=this;return(0,E.jsx)(I.Z,(0,a.Z)((0,a.Z)({title:(0,E.jsx)("div",{style:{fontSize:14},children:(0,E.jsx)("div",{children:"\u8d26\u5355\u65e5\u5386"})}),placement:"bottom",closable:!0,className:"calendar-drawer",height:"700px",bodyStyle:{display:"flex",justifyContent:"center"}},this.props),{},{children:(0,E.jsx)(y.Z,{spinning:this.state.loading,children:(0,E.jsx)(L.Z,{className:"calendar",fullscreen:!1,onChange:this.handleChangeMonth,dateFullCellRender:this.dateCellRender,headerRender:function(t){var n=t.value,a=t.onChange;return(0,E.jsx)("div",{style:{padding:8,textAlign:"center"},children:(0,E.jsx)(k.Z,{value:e.state.selectedMonth,onlyShowMonth:!0,onChange:function(e){var t=n.clone();t.year(D()(e).year()),t.month(D()(e).month()),a(t)}})})}})})}))}}]),n}(w.Component),N=P,V=n(8261),q=n(2061),Y=function(e){(0,r.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,s.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={transactions:[],stats:{},loading:!1},e.handleQueryTagTransaction=function(t){t&&(e.setState({loading:!0}),(0,O.he)("/api/auth/transaction?tag=".concat(t)).then((function(t){var n={};t.forEach((function(e){n[e.id]?n[e.id].childs.push(e):n[e.id]={date:e.date,payee:e.payee,desc:e.desc,tags:e.tags,childs:[e]}})),e.setState({transactions:Object.values(n)})})).catch(console.error).finally((function(){e.setState({loading:!1})})))},e.handleStatsTagTransaction=function(t){t&&(e.setState({loading:!0}),(0,O.he)("/api/auth/stats/total?tag=".concat(t)).then((function(t){e.setState({stats:t})})).catch(console.error))},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.props.tag&&(this.handleQueryTagTransaction(this.props.tag),this.handleStatsTagTransaction(this.props.tag))}},{key:"componentWillReceiveProps",value:function(e){this.props.tag!==e.tag&&(this.handleQueryTagTransaction(e.tag),this.handleStatsTagTransaction(e.tag))}},{key:"render",value:function(){var e=this.props.tag,t=this.state,n=t.transactions,s=t.stats,i=t.loading;return(0,E.jsx)(I.Z,(0,a.Z)((0,a.Z)({title:(0,E.jsxs)("div",{style:{fontSize:14},children:[(0,E.jsxs)("div",{children:["\u6807\u7b7e\uff1a",e]}),(0,E.jsxs)("div",{children:["\u6700\u8fd1",n.length,"\u6761\u4ea4\u6613\u8bb0\u5f55",s.Expenses&&"\uff0c".concat(O.Qr.Expenses).concat((0,M.Z)("Expenses:",s.Expenses)),s.Income&&"\uff0c".concat(O.Qr.Income).concat((0,M.Z)("Income:",s.Income)),s.Liabilities&&"\uff0c".concat(O.Qr.Liabilities).concat((0,M.Z)("Liabilities:",s.Liabilities))]})]}),placement:"bottom",closable:!0,className:"page-drawer",height:"90vh",bodyStyle:{display:"flex",justifyContent:"center"}},this.props),{},{children:(0,E.jsx)("div",{className:"page-form",children:(0,E.jsx)(f.ZP,{itemLayout:"horizontal",loading:i,dataSource:n,renderItem:function(e){return(0,E.jsx)(f.ZP.Item,{children:(0,E.jsx)(f.ZP.Item.Meta,{title:e.desc,description:(0,E.jsxs)(w.Fragment,{children:[(0,E.jsx)("div",{children:e.tags.map((function(e){return(0,E.jsxs)("a",{style:{marginRight:"4px"},children:["#",e]})}))}),(0,E.jsxs)("span",{children:[e.date,"\xa0",e.payee]}),(0,E.jsx)(f.ZP,{itemLayout:"horizontal",dataSource:e.childs,renderItem:function(e){var t,n,a=e.costCurrency&&e.currency!==e.costCurrency,s=Boolean(e.price);return a&&(t=(0,q.Z)(e.costPrice).mul((0,q.Z)(e.number).abs()),s&&(n=(0,q.Z)(e.price).sub((0,q.Z)(e.costPrice)).mul((0,q.Z)(e.number).abs()))),(0,E.jsx)(f.ZP.Item,{style:{marginLeft:"40px"},actions:[e.number+" "+e.currency],children:(0,E.jsx)(f.ZP.Item.Meta,{avatar:(0,E.jsx)(S.Z,{iconType:(0,O.h$)(e.account)}),title:e.account,description:(0,E.jsx)("div",{children:a&&(0,E.jsx)("div",{style:{marginTop:"13px"},children:s?(0,E.jsxs)(w.Fragment,{children:[(0,E.jsxs)(j.Z,{children:["\u6210\u672c: ",e.costPrice," (",e.costDate,")"]}),(0,E.jsxs)(j.Z,{children:["\u786e\u8ba4\u51c0\u503c: ",e.price]}),n>=0?(0,E.jsxs)(w.Fragment,{children:[(0,E.jsxs)(j.Z,{icon:(0,E.jsx)(h.Z,{}),color:"#f50",children:[(100*Number(n)/Number(t)).toFixed(2),"%"]}),(0,E.jsxs)(j.Z,{color:"#f50",children:["+",Math.abs(n).toFixed(2)]})]}):(0,E.jsxs)(w.Fragment,{children:[(0,E.jsxs)(j.Z,{icon:(0,E.jsx)(d.Z,{}),color:"#1DA57A",children:[(100*Number(n)/Number(t)).toFixed(2),"%"]}),(0,E.jsxs)(j.Z,{color:"#1DA57A",children:["-",Math.abs(n).toFixed(2)]})]})]}):(0,E.jsx)(w.Fragment,{children:(0,E.jsxs)(j.Z,{children:["\u51c0\u503c: ",e.costPrice]})})})})})})}})]})})})}})})}))}}]),n}(w.Component),z=Y,F=n(9277),Q=n(5789),R=g.Z.TabPane,G=function(e){var t=e.loading,n=e.transactionGroups,a=e.type,s=e.onOpenAccountDrawer,i=e.onOpenTagDrawer;return(0,E.jsx)("div",{style:{minHeight:"400px"},children:t||0!==n.length?(0,E.jsx)(y.Z,{tip:"\u52a0\u8f7d\u4e2d...",style:{marginTop:"1rem"},spinning:t,children:n.map((function(e){return(0,E.jsx)(f.ZP,{split:!1,header:(0,E.jsxs)("div",{children:[D()(e.date).format("YYYY\u5e74M\u6708D\u53f7"),"\xa0\xa0",e.date===D()().format("YYYY-MM-DD")&&(0,E.jsx)(j.Z,{color:"#1DA57A",children:"\u4eca\u5929"})]}),itemLayout:"horizontal",dataSource:e.children,renderItem:function(e){return(0,E.jsx)(f.ZP.Item,{actions:[e.number?(0,E.jsx)("div",{children:(0,M.Z)(e.account,e.number,e.currencySymbol,e.currency)}):""],children:(0,E.jsx)(f.ZP.Item.Meta,{avatar:(0,E.jsx)(S.Z,{iconType:(0,O.h$)(e.account)}),title:e.desc,description:(0,E.jsxs)("div",{children:[e.tags&&(0,E.jsx)("div",{children:e.tags.map((function(e){return(0,E.jsxs)("a",{style:{marginRight:"4px"},onClick:function(){return i(e)},children:["#",e]})}))}),e.date,"\xa0",(0,E.jsx)("span",{style:{textDecoration:"underline",cursor:"pointer"},onClick:function(){s(e.account)},children:(0,O.Py)(e.account)}),"\xa0",e.payee]})})})}},e.date)}))}):(0,E.jsx)(m.Z,{description:"\u65e0".concat(O.Qr[a],"\u5185\u5bb9")})})},H=function(e){(0,r.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,s.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).theme=e.context.theme,e.formRef=w.createRef(),e.ledgerId=window.localStorage.getItem("ledgerId"),e.currentMonth=D()().format("YYYY-M"),e.state={loading:!1,hideMoney:JSON.parse(window.localStorage.getItem("hideMoney")||"false"),Income:0,Expenses:0,Liabilities:0,listLoading:!1,type:"Expenses",transactionDateGroup:{},selectedMonth:e.currentMonth,addTransactionDrawerVisible:!1,accountTransactionDrawerVisible:!1,selectedAccount:null,tagTransactionDrawerVisible:!1,selectedTag:null,calendarDrawerVisible:!1},e.queryMonthStats=function(){e.setState({loading:!0}),(0,O.he)("/api/auth/stats/total?year=".concat(D()(e.state.selectedMonth).year(),"&month=").concat(D()(e.state.selectedMonth).month()+1)).then((function(t){var n=t.Income,a=void 0===n?0:n,s=t.Expenses,i=void 0===s?0:s,r=t.Liabilities,c=void 0===r?0:r,o=t.Assets,l=void 0===o?0:o;e.setState({Income:a,Expenses:i,Liabilities:c,Assets:l})})).catch(console.error).finally((function(){e.setState({loading:!1})}))},e.queryTransactionList=function(){var t=e.state,n=t.type,a=t.selectedMonth;e.setState({listLoading:!0}),(0,O.he)("/api/auth/transaction?type=".concat(n,"&year=").concat(D()(a).year(),"&month=").concat(D()(a).month()+1)).then((function(t){var n={};t.forEach((function(e){var t=e.date,a=n[t];a?a.children.push(e):n[t]={date:t,children:[e]}})),e.setState({transactionDateGroup:n})})).catch(console.error).finally((function(){e.setState({listLoading:!1})}))},e.handleChangeEntryType=function(t){e.setState({type:t},(function(){e.queryTransactionList()}))},e.handleChangeMonth=function(t){e.setState({selectedMonth:t},(function(){e.queryMonthStats(),e.queryTransactionList()}))},e.handleOpenDrawer=function(){e.setState({addTransactionDrawerVisible:!0})},e.handleCloseDrawer=function(){e.setState({addTransactionDrawerVisible:!1})},e.handleNavigateImportPage=function(){e.props.history.replace("./import")},e.handleAddTransaction=function(){e.queryMonthStats(),e.queryTransactionList(),e.handleCloseDrawer()},e.handleHideMoney=function(){var t=!e.state.hideMoney;e.setState({hideMoney:t}),window.localStorage.setItem("hideMoney",t)},e.handleOpenAccountTransactionDrawer=function(t){e.setState({accountTransactionDrawerVisible:!0,selectedAccount:t})},e.handleCloseAccountTransactionDrawer=function(){e.setState({accountTransactionDrawerVisible:!1})},e.handleOpenTagTransactionDrawer=function(t){e.setState({tagTransactionDrawerVisible:!0,selectedTag:t})},e.handleCloseTagTransactionDrawer=function(){e.setState({tagTransactionDrawerVisible:!1})},e.handleOpenCalendarDrawer=function(){e.setState({calendarDrawerVisible:!0})},e.handleCloseCalendarDrawer=function(){e.setState({calendarDrawerVisible:!1})},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){window.localStorage.getItem("ledgerId")?(this.queryMonthStats(),this.queryTransactionList()):this.props.history.replace("/ledger")}},{key:"render",value:function(){this.context.theme!==this.theme&&(this.theme=this.context.theme);var e=this.state,t=e.loading,n=e.listLoading,s=e.transactionDateGroup,i=e.addTransactionDrawerVisible,r=e.hideMoney,c=e.accountTransactionDrawerVisible,m=e.tagTransactionDrawerVisible,y=Object.values(s);return(0,E.jsxs)("div",{className:"index-page page",children:[(0,E.jsxs)("div",{className:"top-wrapper",children:[(0,E.jsxs)("div",{children:[(0,E.jsx)(k.Z,{value:this.state.selectedMonth,onChange:this.handleChangeMonth}),"\xa0\xa0",r?(0,E.jsx)(Z.Z,{size:"small",icon:(0,E.jsx)(o.Z,{}),onClick:this.handleHideMoney}):(0,E.jsx)(Z.Z,{size:"small",icon:(0,E.jsx)(l.Z,{}),onClick:this.handleHideMoney})]}),(0,E.jsxs)("div",{children:[this.state.Assets>0&&!r&&(0,E.jsxs)(j.Z,{icon:(0,E.jsx)(h.Z,{}),color:"#f50",children:["\u6708\u8d44\u4ea7\uff1a",(0,M.Z)("Assets:",this.state.Assets)]}),this.state.Assets<0&&!r&&(0,E.jsxs)(j.Z,{icon:(0,E.jsx)(d.Z,{}),color:"#1DA57A",children:["\u6708\u8d44\u4ea7\uff1a",(0,M.Z)("Assets:",this.state.Assets)]}),(0,E.jsx)(Z.Z,{size:"small",icon:(0,E.jsx)(u.Z,{}),onClick:this.handleOpenCalendarDrawer,children:"\u65e5\u5386"}),"\xa0\xa0",(0,E.jsx)(Z.Z,{size:"small",icon:(0,E.jsx)(p.Z,{}),onClick:this.handleNavigateImportPage,children:"\u5bfc\u5165"}),"\xa0\xa0",(0,E.jsx)(Z.Z,{type:"primary",size:"small",icon:(0,E.jsx)(x.Z,{}),onClick:this.handleOpenDrawer,children:"\u8bb0\u8d26"})]})]}),(0,E.jsx)("div",{style:{textAlign:"center"},children:(0,E.jsxs)(v.Z,{children:[(0,E.jsx)(b.Z,{span:8,children:(0,E.jsx)(V.Z,{hide:r,title:"\u672c\u6708".concat(O.Qr.Income),value:Math.abs(this.state.Income),loading:t,prefix:this.state.Income>0?"-":"+",valueStyle:{color:"#cf1322"}})}),(0,E.jsx)(b.Z,{span:8,children:(0,E.jsx)(V.Z,{hide:r,title:"\u672c\u6708".concat(O.Qr.Expenses),value:Math.abs(this.state.Expenses),loading:t,prefix:this.state.Expenses>=0?"-":"+",valueStyle:{color:"#3f8600"}})}),(0,E.jsx)(b.Z,{span:8,children:(0,E.jsx)(V.Z,{hide:r,title:"\u672c\u6708".concat(O.Qr.Liabilities),value:Math.abs(this.state.Liabilities),loading:t,prefix:this.state.Liabilities>0?"+":"-",valueStyle:{color:"#3f8600"}})})]})}),(0,E.jsxs)(g.Z,{centered:!0,defaultActiveKey:"Expenses",onChange:this.handleChangeEntryType,style:{marginTop:"1rem"},children:[(0,E.jsx)(R,{tab:"\u6536\u5165\u660e\u7ec6",children:(0,E.jsx)(G,{type:"Income",loading:n,transactionGroups:y,onOpenAccountDrawer:this.handleOpenAccountTransactionDrawer,onOpenTagDrawer:this.handleOpenTagTransactionDrawer})},"Income"),(0,E.jsx)(R,{tab:"\u652f\u51fa\u660e\u7ec6",children:(0,E.jsx)(G,{type:"Expenses",loading:n,transactionGroups:y,onOpenAccountDrawer:this.handleOpenAccountTransactionDrawer,onOpenTagDrawer:this.handleOpenTagTransactionDrawer})},"Expenses"),(0,E.jsx)(R,{tab:"\u8d1f\u503a\u660e\u7ec6",children:(0,E.jsx)(G,{type:"Liabilities",loading:n,transactionGroups:y,onOpenAccountDrawer:this.handleOpenAccountTransactionDrawer,onOpenTagDrawer:this.handleOpenTagTransactionDrawer})},"Liabilities")]}),(0,E.jsx)(A.Z,(0,a.Z)((0,a.Z)({},this.props),{},{visible:i,onClose:this.handleCloseDrawer,onSubmit:this.handleAddTransaction})),this.state.selectedAccount&&(0,E.jsx)(C.Z,{account:this.state.selectedAccount,visible:c,onClose:this.handleCloseAccountTransactionDrawer}),this.state.selectedTag&&(0,E.jsx)(z,{tag:this.state.selectedTag,visible:m,onClose:this.handleCloseTagTransactionDrawer}),this.state.selectedMonth&&(0,E.jsx)(N,{month:this.state.selectedMonth,visible:this.state.calendarDrawerVisible,onClose:this.handleCloseCalendarDrawer})]})}}]),n}(w.Component);H.contextType=F.Z;var $=(0,Q.Z)(H)}}]);